{
use esmith::ConfigDB;
use File::Temp;
use NethServer::SSSD;
our $sssd = new NethServer::SSSD();
our $db = esmith::ConfigDB->open_ro() or die "Could not open config db";
our $record = $db->get("sssd") or die "No Workgroup in config db";
our $domain = $record->prop("Workgroup");
our $host = $sssd->host();
our $basedn = $sssd->baseDN();
our $binddn = $sssd->bindDN();
our $secret = $sssd->bindPassword();
our $ldapuserattr = "";

if ($sssd->isAD()) {
   $basedn = "cn=Users," . $basedn;
   $ldapuserattr = "ldap-username-attribute: name";
}

}

# Hostname and port of guacamole proxy
guacd-hostname: localhost
guacd-port:     4822

# MySQL properties
mysql-hostname: localhost
mysql-port: 3306
mysql-database: guacamole
mysql-username: guacamole
mysql-password: guacamole
mysql-default-max-connections-per-user: 0
mysql-default-max-group-connections-per-user: 0

# LDAP properties
ldap-hostname: { $OUT .= "$host"; }
ldap-port: 389
ldap-encryption-method:none
ldap-user-base-dn: { $OUT .= "$basedn"; }
ldap-search-bind-dn: { $OUT .= "$binddn"; }
ldap-search-bind-password: { $OUT .= "$secret"; }
{ $OUT .= "$ldapuserattr"; }
